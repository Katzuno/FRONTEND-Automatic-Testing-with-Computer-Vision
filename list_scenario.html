<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><!doctype html>
        <html lang="en">

        <head>
            <title>Hello, world!</title>
            <!-- Required meta tags -->
            <meta charset="utf-8">
            <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
            <!--     Fonts and icons     -->
            <link rel="stylesheet" type="text/css"
                  href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"/>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
            <!-- Material Kit CSS -->
            <link href="assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet"/>
        </head>

<body>
<div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white">
        <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

        Tip 2: you can also add an image using data-image tag
    -->
        <div class="logo">
            <a href="http://www.creative-tim.com" class="simple-text logo-mini">
                USER_NAME
            </a>
            <a href="http://www.creative-tim.com" class="simple-text logo-normal">
                Automation Testing
            </a>
        </div>
        <div class="sidebar-wrapper">
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link" href="#0">
                        <i class="material-icons">dashboard</i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="add_scenario.html">
                        <i class="material-icons">content_copy</i>
                        <p>Add test scenario</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="add_scenario.html">
                        <i class="material-icons">content_copy</i>
                        <p>List test scenario</p>
                    </a>
                </li>
                <!-- your sidebar here -->
            </ul>
        </div>
    </div>
    <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
            <div class="container-fluid">
                <div class="navbar-wrapper">
                    <a class="navbar-brand" href="javascript:;">Dashboard</a>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:;">
                                <i class="material-icons">notifications</i> Notifications
                            </a>
                        </li>
                        <!-- your navbar here -->
                    </ul>
                </div>
            </div>
        </nav>
        <!-- End Navbar -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title">Add testing scenario</h4>
                                <p class="card-category">Complete the following fields</p>
                            </div>
                            <div class="card-body">
                                <form id = "add_testing_scenario">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">API calls</label>
                                                <textarea type="text" class="form-control" id = "api_calls" rows="10" style="width: 500px;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title ">Scenarios List</h4>
                                <p class="card-category"> See your scenarios </p>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead class=" text-primary">
                                        <th>
                                            ID
                                        </th>
                                        <th>
                                            Name
                                        </th>

                                        <th>
                                            Actions
                                        </th>
                                        </thead>
                                        <tbody id="scenesList">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="container-fluid">
                <nav class="float-left">
                    <ul>
                        <li>
                            <a href="https://www.creative-tim.com">
                                Automation Testing
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="copyright float-right">
                    &copy;
                    <script>
                        document.write(new Date().getFullYear())
                    </script>
                    , made with <i class="material-icons">favorite</i> by
                    <a href="https://www.creative-tim.com" target="_blank">Automation Testing</a> for a better web.
                </div>
                <!-- your footer here -->

                <!--   Core JS Files   -->
                <script src="assets/js/core/jquery.min.js"></script>
                <script src="assets/js/core/popper.min.js"></script>
                <script src="assets/js/core/bootstrap-material-design.min.js"></script>
                <script src="assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
                <!-- Plugin for the momentJs  -->
                <script src="assets/js/plugins/moment.min.js"></script>
                <!-- Forms Validations Plugin -->
                <script src="assets/js/plugins/jquery.validate.min.js"></script>
                <!-- Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
                <script src="assets/js/plugins/jquery.bootstrap-wizard.js"></script>
                <!--	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
                <script src="assets/js/plugins/bootstrap-selectpicker.js"></script>
                <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
                <script src="assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>

                <script type="text/javascript">
                    async function postData(url = '', data = {}, head = {'Content-Type': 'application/json'}) {
                        // Default options are marked with *
                        const response = await fetch(url, {
                            method: 'POST', // *GET, POST, PUT, DELETE, etc.
                            mode: 'cors', // no-cors, *cors, same-origin
                            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                            credentials: 'same-origin', // include, *same-origin, omit
                            headers: head,
                            redirect: 'follow', // manual, *follow, error
                            referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                            body: JSON.stringify(data) // body data type must match "Content-Type" header
                        });
                        return response.json(); // parses JSON response into native JavaScript objects
                    }
                </script>

                <script type="text/javascript">
                    function run_test(sceneId) {
                        let userId = localStorage.getItem('userId');
                        alert('Scene started to execute. Please recheck in a few minutes!');
                        postData('http://localhost:5000/run/scene', {
                            'user_id': userId,
                            'scene_id': sceneId
                        }).then(function (res) {
                            alert(res.message);
                        });
                    }

                    function get_results(sceneId) {
                        let userId = localStorage.getItem('userId');
                        postData('http://localhost:5000/get/scene/output', {
                            'user_id': userId,
                            'scene_id': sceneId
                        }).then(function (res) {
                            $("#api_calls").val(res.output);
                        });
                    }

                    let scenesList = $("#scenesList");

                    postData('http://localhost:5000/get/scenes', {'user_id': 1}).then(function (res) {
                        let scenes = res['scenes'];
                        let tableRow;

                        for (let i in scenes) {
                            index = parseInt(i) + 1;
                            tableRow = "<tr>" +
                                "                                            <td>" + (index) + "</td>" +
                                "                                               <td>" + scenes[i] + "</td>" +
                                "                                            <td class=\"text-primary\">" +
                                "                                                <a href='#' style = 'border: 1px solid black' onclick = run_test(" + index + ")> Run test </a>"  +
                                "                                                <a href = '#' style = 'border: 1px solid black'  onclick = get_results(" + index + ")> Get scenes results </a>" +
                                "                                            </td>" +
                                "                 </tr>";
                            scenesList.append(tableRow);
                        }

                    });


                </script>
            </div>
        </footer>
    </div>
</div>
</body>

</html>
</title>
</head>
<body>

</body>
</html>
